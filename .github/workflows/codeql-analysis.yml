name: "Code scanning - action"

on:
  # TODO: Delete it later.
  push:
    branches:
      - "add-dump-action"
      - "main"

jobs:
  dump_contexts_to_log:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: ./.github/actions/dump-context

  CodeQL-Build:
    runs-on: ubuntu-latest
    container:
      image: ghcr.io/vdaas/vald/vald-ci-container:nightly
    steps:
      - uses: actions/checkout@v3
        with:
          # We must fetch at least the immediate parents so that if this is
          # a pull request then we can checkout the head.
          fetch-depth: 2
          path: ${{ github.workspace }}
          set-safe-directory: true
      - name: Initialize CodeQL
        uses: github/codeql-action/init@v2
        with:
          languages: go
          config-file: ./.github/codeql/codeql-config.yaml
      - name: Autobuild
        uses: github/codeql-action/autobuild@v2
      - name: Perform CodeQL Analysis
        uses: github/codeql-action/analyze@v2
